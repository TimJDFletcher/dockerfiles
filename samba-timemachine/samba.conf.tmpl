[global]
    # Basic Server Settings
    log level               = ${LOG_LEVEL}
    workgroup               = WORKGROUP
    server min protocol     = SMB3_00
    smb ports               = 10445

    # Network & Security (Docker Optimized)
    # Disable NetBIOS/NBT; we rely on DNS/IP and Docker networking
    disable netbios         = yes
    server services         = -dns, -nbt
    restrict anonymous      = 2
    
    # We don't need these in a container
    load printers           = no
    printing                = bsd
    printcap name           = /dev/null
    disable spoolss         = yes

    # Apple / Time Machine Compatibility (vfs_fruit)
    # Order matters: catia (character mapping) -> fruit (metadata) -> streams_xattr (store streams)
    vfs objects             = catia fruit streams_xattr
    
    # Fruit Global Settings
    fruit:aapl              = yes
    fruit:nfs_aces          = no
    fruit:metadata          = stream
    fruit:model             = TimeCapsule6
    fruit:posix_rename      = yes
    fruit:veto_appledouble  = no
    fruit:wipe_intentionally_left_blank_rfork = yes
    fruit:delete_empty_adfiles = yes
    
    # Critical for Time Machine reliability on modern macOS
    fruit:advertise_fullsync = true

[Data]
    comment                 = Apple TimeMachine Backup
    path                    = ${BACKUPDIR}
    valid users             = ${USER}
    read only               = no
    writable                = yes
    browseable              = yes
    
    # Time Machine Specifics
    fruit:time machine      = yes
    fruit:time machine max size = ${QUOTA_IN_GIGABYTES}G
    
    # Permissions & ACLs
    # "nt acl support = no" forces client to use standard POSIX perms, which is usually safer for Docker volumes
    inherit acls            = yes
    nt acl support          = no
    
    # Spotlight is best handled by the client for simple Docker setups
    spotlight               = no

# vi:syntax=samba
