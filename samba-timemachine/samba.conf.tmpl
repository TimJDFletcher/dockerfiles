[global]
log level               = ${LOG_LEVEL}
netbios name            = TIMECAPSULE
passdb backend          = tdbsam
security                = user
smb ports               = 10445
workgroup               = WORKGROUP

# disable things we don't need
disable netbios         = yes
disable spoolss         = yes
load printers           = no
printcap name           = /dev/null
printing                = bsd
server role             = standalone
server services         = -dns, -nbt

# Apple configuration taken from:
# https://wiki.samba.org/index.php/Configure_Samba_to_Work_Better_with_Mac_OS_X and
# https://jansblog.org/2021/05/16/samba-based-timemachine-with-big-sur/
vfs objects                                 = catia fruit streams_xattr acl_xattr 
fruit:aapl                                  = yes
fruit:delete_empty_adfiles                  = yes
fruit:metadata                              = stream
fruit:model                                 = TimeCapsule6
fruit:nfs_aces                              = no
fruit:posix_rename                          = yes
fruit:veto_appledouble                      = no
fruit:wipe_intentionally_left_blank_rfork   = yes

# Security
idmap config * : backend    = tdb
idmap config * : range      = 300000-400000
restrict anonymous          = 2
server min protocol         = SMB3
username map                = /etc/samba/users.map

[Data]
browseable                  = yes
comment                     = Apple TimeMachine Backup Target
fruit:time machine          = yes
fruit:time machine max size = ${QUOTA_IN_GIGABYTES}G
inherit acls                = yes
nt acl support              = no
path                        = ${BACKUPDIR}
read only                   = no
spotlight                   = no
valid users                 = ${USER}
writable                    = yes

# vi:syntax=samba
