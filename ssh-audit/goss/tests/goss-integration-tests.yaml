command:
  # === Hardened sshd (test-sshd) ===
  # Should pass audit with exit code 0 (no warnings or failures)
  ssh-audit -p 2222 test-sshd:
    exit-status: 0
    stdout:
      - "(gen) banner:"
      - "(kex)"
      - "(key)"
    stderr:
      - "!/\\[fail\\]/"
      - "!/\\[warn\\]/"
    timeout: 15000

  # JSON output mode against hardened sshd
  ssh-audit -p 2222 --json test-sshd:
    exit-status: 0
    stdout:
      - '"banner":'
      - '"kex":'
    timeout: 15000

  # === Weak/insecure sshd (weak-sshd) ===
  # Should detect security issues and report failures
  ssh-audit -p 2222 weak-sshd:
    exit-status:
      # Expect exit code 2 or 3 (failures or critical issues)
      ge: 2
    stdout:
      # Must detect weak algorithms
      - "[fail]"
      - "(kex)"
      - "(enc)"
      - "(mac)"
    timeout: 15000

  # JSON output should contain failure indicators
  ssh-audit -p 2222 --json weak-sshd:
    exit-status:
      ge: 2
    stdout:
      - '"banner":'
      - '"fail"'
    timeout: 15000
